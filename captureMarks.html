<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mathematics - Grade 12 Only</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
        }

        header {
      background-color: #ffffff;
      padding: 20px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #ddd;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 10;
    }

        header h1 {
            margin: 0;
            display: inline-block;
            font-size: 18px;
        }

        nav {
            display: inline-block;
            margin-left: 50px;
        }
        
        header img {
            height: 34px;
        }

        nav a {
            margin: 0 15px;
            text-decoration: none;
            color: black;
            font-weight: bold;
        }

        nav a:hover {
            text-decoration: underline;
        }

        .content {
            margin: 40px auto;
            padding: 20px;
            width: 60%;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table, th, td {
            border: 2px solid black;
        }

        th, td {
            padding: 15px;
            text-align: center;
            font-size: 16px;
        }

        th {
            font-weight: bold;
        } tfoot td span{
            margin-top: 0;
            padding: 0;
            border: none;
        }

        .btn {
           justify-content: left;
            margin-top: 10px;
            padding: 10px 20px;
          ;
            color: black;
            
        
            cursor: pointer;
            font-size: 16px;
        }

        .btn:hover {
            background-color: #838784;
        }

        footer {
            background-color: #d3d3d3;
            padding: 10px;
            text-align: center;
            position: fixed;
            width: 100%;
            bottom: 0;
        }

        footer p {
            margin: 0;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 5px;
            box-sizing: border-box;
        }

        .chart-container-wrapper {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 30px;
        }

        .chart-container {
            flex: 1;
            max-width: 48%;
        }

        canvas {
            width: 100% !important;
            height: auto !important;
        }
              /* Chatbot Styles */
    #open-chatbot-button {
        background-color: #747674;
        color: #e0e0e0;
        padding: 10px 20px;
        border: none;
        border-radius: 20px;
        font-size: 1em;
        cursor: pointer;
        transition: background-color 0.3s;
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
    }

    #open-chatbot-button:hover {
        background-color: #66bb6a;
    }

    #eduvisor-container {
        display: none;
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 100%;
        max-width: 400px;
        height: 500px;
        background-color: ;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.4);
        flex-direction: column;
        border-radius: 8px;
        overflow: hidden;
        z-index: 1000;
    }
    #eduvisor-header img {
        height: 60px;
        margin-left: 25px;
    }
    #eduvisor-header {
        background-color: #fff;
        padding: 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: #000;
    }

    #chat-display {
        flex-grow: 1;
        padding: 15px;
        overflow-y: auto;
        background-color: #222;
    }

    .message {
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 8px;
        max-width: 80%;
        word-wrap: break-word;
    }

    .user-message {
        background-color: #37474f;
        align-self: flex-end;
        text-align: right;
    }

    .eduvisor-message {
        background-color: #4caf50;
        align-self: flex-start;
    }

    #input-container {
        display: flex;
        border-top: 1px solid #333;
    }

    #user-input {
        flex-grow: 1;
        padding: 10px;
        font-size: 1em;
        background-color: #333;
        border: none;
        color: #e0e0e0;
        outline: none;
    }

    #send-button {
        padding: 10px 15px;
        background-color: #4caf50;
        color: #e0e0e0;
        border: none;
        cursor: pointer;
        font-size: 1em;
        outline: none;
    }

    #send-button:hover {
        background-color: #66bb6a;
    }

    #close-chatbot-button {
        background-color: #444;
        border: none;
        color: white;
        padding: 5px 10px;
        font-size: 0.9em;
        cursor: pointer;
    }
    .export-btn {
    align-self: flex-end;
    margin-top: auto;
    margin-left: 10px;
}
    /* Adjusted styling for the add row symbol */
    #addRowSymbol {
        font-size: 24px;
        cursor: pointer;
        border: 1px solid #000; /* Small border around the symbol */
        padding: 5px 10px; /* Adjust padding for a cleaner look */
        border-radius: 4px; /* Optional: rounded corners */
        display: inline-block;
    }
</style>

    </style>
</head>
<body>

    <!-- Header Section -->
    <header>
        <a href="homepage.html"><img src="Eduvisor-removebg-preview.png" alt="University Logo"></a>
        <nav>
          <a href="#">Announcements</a>
          <a href="CALENDER.html">Calendar</a>
          <a href="#">Discover</a>
          <a href="index.html">Exit</a>
        </nav>
      </header>


    <!-- Main Content Section -->
    <div class="content">
        <h2>Mathematics - Grade 12</h2>

        <!-- Flex container for side-by-side charts -->
        <div class="chart-container-wrapper">
            <div class="chart-container">
                <h3>Latest Grades</h3>
                <canvas id="latestGradeChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Previous Grades Snapshot</h3>
                <canvas id="previousGradeChart"></canvas>
            </div>
            <!-- PDF Export Button aligned to the right -->
            <button class="btn export-btn" onclick="exportPDF()">GET PDF</button>
        </div>

      <!-- Table with Add Row Symbol -->
<form id="marksForm" style="margin-top: 20px;">
    <table id="marksTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Marks</th>
                <th>Grade</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr>
                <td><input type="text" name="name[]" placeholder="Enter name"></td>
                <td><input type="number" name="marks[]" placeholder="Enter marks" min="0" max="100" class="marksInput"></td>
                <td><input type="text" name="grade[]" placeholder="Grade" readonly></td>
            </tr>
        </tbody>
        <!-- Add Row Symbol -->
        <tfoot>
            <tr>
                <td colspan="3" style="text-align: left;">
                    <span id="addRowSymbol" style="font-size: 24px; cursor: pointer;">+</span>
                </td>
            </tr>
        </tfoot>
    </table>
    
</form>

    </div>
    <button id="open-chatbot-button">FAQ</button>

    <!-- Chatbot Popup -->
    <div id="eduvisor-container">
        
        <div id="eduvisor-header">
            <img src="ALMOST-removebg-preview.png" alt="">
            <p><b>Eduvisor Assistant</b></p>
            <button id="close-chatbot-button">Close</button>
        </div>
        <div id="chat-display"></div>
        <div id="input-container">
            <input type="text" id="user-input" placeholder="Ask Eduvisor about school..." />
            <button id="send-button">Send</button>
        </div>
    </div>
    <!-- Footer Section -->
    

    <!-- Libraries for Chart.js, jsPDF, and html2canvas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.21/jspdf.plugin.autotable.min.js"></script>


    <script>
        const addRowBtn = document.getElementById('addRowBtn');
        const tableBody = document.getElementById('tableBody');
        const marksForm = document.getElementById('marksForm');

        // Initialize latest chart
        const ctxLatest = document.getElementById('latestGradeChart').getContext('2d');
        const latestGradeChart = new Chart(ctxLatest, {
            type: 'bar',
            data: {
                labels: [], 
                datasets: [{
                    label: 'Marks',
                    data: [], 
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });

        // Initialize previous snapshot chart
        const ctxPrevious = document.getElementById('previousGradeChart').getContext('2d');
        const previousGradeChart = new Chart(ctxPrevious, {
            type: 'bar',
            data: {
                labels: [], 
                datasets: [{
                    label: 'Marks',
                    data: [],
                    backgroundColor: 'rgba(255, 99, 132, 0.6)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });

        function calculateGrade(marks) {
            if (marks >= 80) return 'A';
            else if (marks >= 70) return 'B';
            else if (marks >= 60) return 'C';
            else if (marks >= 50) return 'D';
            else if (marks >= 40) return 'E';
            else return 'Fail';
        }

       // Event listener for the "+" symbol to add a new row
const addRowSymbol = document.getElementById('addRowSymbol');

addRowSymbol.addEventListener('click', function() {
    const newRow = document.createElement('tr');
    const inputs = ['name', 'marks', 'grade'];
    inputs.forEach((inputName) => {
        const newCell = document.createElement('td');
        const newInput = document.createElement('input');
        newInput.type = inputName === 'marks' ? 'number' : 'text';
        newInput.name = `${inputName}[]`;
        newInput.placeholder = inputName === 'marks' ? `Enter ${inputName} (0-100)` : `Enter ${inputName}`;
        if (inputName === 'marks') {
            newInput.classList.add('marksInput');
            newInput.min = 0;
            newInput.max = 100;
        }
        if (inputName === 'grade') newInput.readOnly = true;
        newCell.appendChild(newInput);
        newRow.appendChild(newCell);
    });
    tableBody.appendChild(newRow);
});

        function updateCharts() {
            previousGradeChart.data.labels = [...latestGradeChart.data.labels];
            previousGradeChart.data.datasets[0].data = [...latestGradeChart.data.datasets[0].data];
            previousGradeChart.update();

            const names = Array.from(marksForm.querySelectorAll('input[name="name[]"]')).map(input => input.value);
            const marks = Array.from(marksForm.querySelectorAll('input[name="marks[]"]')).map(input => parseInt(input.value, 10) || 0);

            latestGradeChart.data.labels = names;
            latestGradeChart.data.datasets[0].data = marks;
            latestGradeChart.update();
        }

        document.addEventListener('input', function(event) {
            if (event.target.classList.contains('marksInput')) {
                const marksInput = event.target;
                const marks = parseInt(marksInput.value, 10);
                const gradeInput = marksInput.closest('tr').querySelector('input[name="grade[]"]');
                gradeInput.value = calculateGrade(marks);
                updateCharts();
            }
        });

        async function exportPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    // Generate the charts as images
    const canvas1 = await html2canvas(document.querySelector('#latestGradeChart'));
    const canvas2 = await html2canvas(document.querySelector('#previousGradeChart'));

    const chartImage1 = canvas1.toDataURL('image/png');
    const chartImage2 = canvas2.toDataURL('image/png');

    // Add both charts on the same page, adjusting their sizes and positions
    pdf.text("Latest Grades and Previous Grades Snapshot", 15, 15);

    // Set the width and height for both charts
    const chartWidth = 75;  // Adjust this value to reduce the size
    const chartHeight = 60;  // Adjust this value to reduce the size

    // Add the first chart to the PDF
    pdf.addImage(chartImage1, 'PNG', 10, 25, chartWidth, chartHeight);

    // Add the second chart to the PDF, next to the first one
    pdf.addImage(chartImage2, 'PNG', 90, 25, chartWidth, chartHeight);

    // Add a new page for the table content
    pdf.addPage();
    pdf.text("Student Marks and Grades", 15, 15);

    // Get the data from the table
    const tableData = [];
    const rows = document.querySelectorAll('#marksTable tbody tr');
    rows.forEach(row => {
        const rowData = [];
        row.querySelectorAll('input').forEach(input => {
            rowData.push(input.value);
        });
        tableData.push(rowData);
    });

    // Add table headers
    const headers = ["Name", "Marks", "Grade"];
    pdf.autoTable({
        head: [headers],
        body: tableData,
        startY: 30, // Start the table below the title
        theme: 'grid', // Use a grid-style theme for the table
        headStyles: { fillColor: [22, 160, 133] }, // Optional: table header color
        margin: { top: 20 }, // Adjust margin for better spacing
    });

    // Save the generated PDF
    pdf.save("Grade_Charts_and_Marks.pdf");
}


          // JavaScript for Popup Control
      const chatbotContainer = document.getElementById("eduvisor-container");
      const openChatbotButton = document.getElementById("open-chatbot-button");
      const closeChatbotButton = document.getElementById("close-chatbot-button");

      openChatbotButton.addEventListener("click", () => {
          chatbotContainer.style.display = "flex";
      });

      closeChatbotButton.addEventListener("click", () => {
          chatbotContainer.style.display = "none";
      });

      // Chatbot functionality
      const chatDisplay = document.getElementById("chat-display");
      const userInput = document.getElementById("user-input");
      const sendButton = document.getElementById("send-button");

      const responses = {
    "homework": "Homework can pile up fast! Try setting aside a regular time each day to tackle it, and reward yourself with a little break after each task. Even a small effort each day makes a big difference in the long run!",
    
    "study tips": "Studying doesn’t have to be a chore. Try finding what works best for you—some people love listening to music, others need total silence. Mix it up sometimes with study games, or see if teaching a friend helps you remember better!",
    
    "exams": "Exam prep can be intense. Focus on the topics that seem tricky, and try practice questions if you have them. Remember to take care of yourself—good sleep and some downtime can help more than cramming all night!",
    
    "time management": "Managing time is tough but worth it! Use a planner or even just a to-do list on your phone. Balance your study time with some relaxation, and don’t forget to celebrate small wins along the way. A good routine can make a huge difference!",
    
    "project help": "Projects can feel overwhelming, but tackling them one step at a time makes it easier. Map out each stage, and set a timeline for each part. Don’t be afraid to ask for help if you get stuck. Teamwork can make projects so much easier to handle!",
    
    "mental health": "Life can get overwhelming sometimes, especially with school and other responsibilities. Take time for yourself, whether it's reading a book, going for a walk, or chatting with a friend. Remember, mental health is just as important as physical health!",
    
    "stress": "When stress builds up, it’s okay to step back and take a break. Try deep breathing exercises or write down what’s on your mind. Taking it one step at a time can make challenges feel more manageable.",
    
    "motivation": "We all have days where motivation is hard to find. Sometimes changing your environment or listening to music can help lift your mood. Set small, achievable goals to get started. Once you get going, it often becomes easier!",
    
    "focus": "Staying focused can be a challenge, especially with distractions all around. Try the Pomodoro Technique (25 minutes work, 5-minute break) or a change of scenery. Don’t be too hard on yourself—everyone needs a little reset now and then!",
    
    "self-care": "Self-care is so important! Take time each day to do something you enjoy, even if it’s small. Watch a favorite show, try out a hobby, or go for a walk. Looking after yourself helps you stay energized and positive.",
    
    "friendships": "Balancing friendships with school can be tricky. Try setting aside time to study together or catch up during breaks. Good friends support each other, even if it’s just sending a quick text to check in!",
    
    "default": "Hey there! I’m here to chat about school, life, or anything on your mind. From homework tips to managing stress, let’s take it one step at a time. Reach out anytime you need a little advice or just someone to talk to!"
};


      function displayMessage(text, isEduvisor = false) {
          const messageElement = document.createElement("div");
          messageElement.classList.add("message");
          messageElement.classList.add(isEduvisor ? "eduvisor-message" : "user-message");
          messageElement.textContent = text;
          chatDisplay.appendChild(messageElement);
          chatDisplay.scrollTop = chatDisplay.scrollHeight;
      }

      function getResponse(userMessage) {
          const messageLower = userMessage.toLowerCase();
          for (let key in responses) {
              if (messageLower.includes(key)) {
                  return responses[key];
              }
          }
          return responses["default"];
      }

      sendButton.addEventListener("click", () => {
          const userMessage = userInput.value.trim();
          if (userMessage) {
              displayMessage(userMessage); // Display user message
              const eduvisorResponse = getResponse(userMessage); // Get Eduvisor's response
              setTimeout(() => displayMessage(eduvisorResponse, true), 500); // Display Eduvisor response
              userInput.value = ""; // Clear input field
          }
      });

      userInput.addEventListener("keypress", (event) => {
          if (event.key === "Enter") {
              sendButton.click();
          }
      });
    </script>

</body>
</html>
